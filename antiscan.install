<?php

/**
 * @file
 * Install, update and uninstall functions for the Antiscan module.
 */
 
/**
 * Implements hook_requirements().
 */
function antiscan_requirements($phase) {
  $requirements = array();
  $t = get_t();

  if ($phase == 'install') {
    $ip_blocking_info = system_get_info('module', 'ip_blocking');
      if (empty($ip_blocking_info) || empty($ip_blocking_info['version'])) {
      // The module doesn't exist, it's not enabled?
      return FALSE;
    }
    if (version_compare($ip_blocking_info['version'], '1.x-1.0.5', '<')) {
      $requirements['version'] = array(
        'title' => $t('version'),
        'description' => $t('IP address blocking module must have version 1.x-1.0.5 or newest.'),
        'value' => check_plain($ip_blocking_info['version']),
        'severity' => REQUIREMENT_ERROR,
      );
    }
  }

  return $requirements;
}

/**
 *  Add and initialize new variable.
 *  Set first starting time for reports.
 */
function antiscan_update_1000() {
  $config = config('antiscan.settings');
  $config->set('abuseipdb_report', 0);
  $config->save();
  
  state_set('antiscan_abuseipdb_report_last_date', time());
}
